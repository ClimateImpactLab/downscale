language: python

python:
- 3.5
- 3.6
- 3.7
- 3.8

matrix:
  allow_failures:
  - python: 3.8
  
install:
- pip install --upgrade pip
- wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
- bash miniconda.sh -b -p $HOME/miniconda
- export PATH="$HOME/miniconda/bin:$PATH"
- hash -r
- conda config --set always_yes yes --set changeps1 no
- conda update -q conda
- conda config --add channels conda-forge
- conda info -a

- conda create -q -n test-env python=$TRAVIS_PYTHON_VERSION
- source activate test-env

- python setup.py install
- python -m pip install -r requirements_dev.txt
- conda install --yes --file requirements_conda.txt

script:
- export PATH=$HOME/miniconda/bin:$PATH
- source activate test-env
- python -m pytest
- sphinx-apidoc -o docs downscale
- sphinx-build -W -b html -d docs/_build/doctrees docs/. docs/_build/html


after_success:
- coveralls

deploy:
  true:
    python: 3.7
    repo: ClimateImpactLab/downscale
    tags: true
  distributions: sdist bdist_wheel
  password:
    secure: Dq0hi0NcAqB22icFyMhY8jjTWNfezRq8qYLgugMiIcTY4YkIHDv4N17mGoTWx0KJ6ULkG0Wlu2XXuP/Sx4FvtWWkpaTNmC5h4o3we1XJDh3oNiWgQ0levPmYpb/BWZBiI2wBiT0yPPSM5cu7qiLWYub00ngOdj7pqEgHX0NTuVRNmmxxJszokHa0FfDE6rOvqkKvrRb1C6panUvrJpcTjN0Ah1AQ4r2JtaynwKbJsKDZXRi64tZ3dyeGP4sZy+LYLYJc6AJxoQDSzahH3UZwxAqRVgNct0JMdeQMiaRiSWa4GbPhuwF33L7E3yMR5IA1FbKjAZFgi/lCTLvuZ1cY7d2NCYWZrnLDUwlCuQ3EUFe57LYhhw3VO0RdCuwJjMUEPjDairAudaJE3tU8lNbwUHxaz9emmRE5gg0kOos4hVM1eGp8JW97o139hTpuT7i503fa5WbKCw8VBH5b4c8ns56/oBtUH2m483ZenN3O4VSkAJps8JW2oeheN30LBQTqdiqo6beKy+mYOQi0alZGcdI504QfxOSl2mm7lxoOTwA7aCdLH8K0rBi3uPo93s/RdYcUgArzKvPzWYrzvmasmTHjmPrdsdbt/uwyqdtK9xpST5DXp/1sJVE/C7EHqW2TI+V8Ui2uAe/B3hthGU95yJftCqTBgm/oEBlM3RhiTDE=
  provider: pypi
  user: delgadom


